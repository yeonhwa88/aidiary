-- [IX] 쇼핑몰 DB설계 및 생성, 입력, 수정

DROP TABLE MEMBER;
DROP TABLE PRODUCT;
DROP TABLE ORDERS;
DROP TABLE CART;
DROP TABLE ORDER_DERAIL;

CREATE SEQUENCE CART_cNO_SEQ
    MAXVALUE 999
    NOCACHE
    NOCYCLE;
CREATE SEQUENCE ORDERS_oNO_SEQ
    MAXVALUE 999
    NOCACHE
    NOCYCLE;
CREATE SEQUENCE ORDER_DERAIL_odNO_SEQ    
    MAXVALUE 999
    NOCACHE
    NOCYCLE;

CREATE TABLE MEMBER (
    mID VARCHAR2(50) ,
    mNAME VARCHAR2(50)NOT NULL,
    mTEL VARCHAR2(50)NOT NULL UNIQUE,
    mADDRESS VARCHAR2(50)NOT NULL ,
    mEMAIL VARCHAR2(50)NOT NULL UNIQUE,
    PRIMARY KEY(mID)
    );
CREATE TABLE PRODUCT(
    pCODE VARCHAR2(50),
    pNAME VARCHAR2(50)NOT NULL,
    PRICE NUMBER(10)NOT NULL,
    STOCK NUMBER(10)NOT NULL,
    PRIMARY KEY (pCODE)
    );
CREATE TABLE CART(
    cNO NUMBER(9),
    mID VARCHAR2(50) NOT NULL,
    pCODE VARCHAR2 (50) NOT NULL,
    QTY NUMBER(9) NOT NULL,
    COST NUMBER(9) NOT NULL,
    PRIMARY KEY (cNO),
    FOREIGN KEY (mID) REFERENCES MEMBER (mID),
    FOREIGN KEY (pCODE) REFERENCES PRODUCT (pCODE)
);
CREATE TABLE ORDERS(
    oNO NUMBER(9),
    mID VARCHAR2(50) NOT NULL,
    oNAME VARCHAR2(50) NOT NULL,
    oADDRESS VARCHAR2(300) NOT NULL,
    oTEL VARCHAR2(50) NOT NULL,
    oDATE DATE NOT NULL,
    PRIMARY KEY(oNO),
    FOREIGN KEY(mID) REFERENCES MEMBER(mID)
);
CREATE TABLE ORDER_DERAIL(
    odNO NUMBER(9),
    oNO NUMBER(9)NOT NULL,
    pCODE VARCHAR2(50)NOT NULL,
    QTY VARCHAR2(50) NOT NULL,
    COST NUMBER(9) NOT NULL,
    PRIMARY KEY(odNO),
    FOREIGN KEY(oNO) REFERENCES ORDERS(oNO),
    FOREIGN KEY(pCODE) REFERENCES PRODUCT(pCODE)
    );

INSERT INTO MEMBER
    VALUES('ABC','홍길동','서울 관악구 신림동','010-9999-999','HONG.HONG.COM');
INSERT INTO MEMBER
    VALUES('DEF','김김동','경기도 수원시','010-8888-8888','KIM@KIM.COM');

INSERT INTO PRODUCT 
    VALUES ('A1', '맥주', 3000, 100);
INSERT INTO PRODUCT 
    VALUES ('A2', '마스크', 200, 100);
INSERT INTO PRODUCT
    VALUES ('B1', '땅콩', 3000, 100);
INSERT INTO PRODUCT
    VALUES ('B2', '오징어', 5000, 100);
INSERT INTO PRODUCT
    VALUES ('C1', '소독약', 7000, 100);
    
INSERT INTO CART 
    VALUES (CART_cNO_SEQ.NEXTVAL, 'ABC', 'A1', 2,(SELECT PRICE FROM PRODUCT WHERE PCODE='A1')*2);
INSERT INTO CART
    VALUES (CART_cNO_SEQ.NEXTVAL, 'ABC', 'B1', 1,(SELECT PRICE FROM PRODUCT WHERE PCODE='B1'));
INSERT INTO CART
    VALUES (CART_cNO_SEQ.NEXTVAL, 'DEF', 'A2', 20,(SELECT PRICE FROM PRODUCT WHERE PCODE='A2')*20);
INSERT INTO CART
    VALUES (CART_cNO_SEQ.NEXTVAL, 'DEF', 'B2', 2,(SELECT PRICE FROM PRODUCT WHERE PCODE='B2')*2);
INSERT INTO CART
    VALUES (CART_cNO_SEQ.NEXTVAL, 'DEF', 'C1', 1,(SELECT PRICE FROM PRODUCT WHERE PCODE='C1'));
INSERT INTO CART
    VALUES (CART_cNO_SEQ.NEXTVAL, 'ABC', 'A1', 2,(SELECT PRICE FROM PRODUCT WHERE PCODE='A1')*2);
INSERT INTO CART
    VALUES (CART_CNO_SEQ.NEXTVAL, 'ABC', 'B1'
    
INSERT INTO ORDERS
    VALUES(ORDERS_oNO_SEQ.NEXTVAL,'ABC','홍아빠','제주도 제주시','010-7777-9999',SYSDATE);
INSERT INTO ORDERS
    VALUES(ORDERS_oNO_SEQ.NEXTVAL,'ABC','홍길동','서울시 관악구 신림동','010-9999-9999',SYSDATE);
INSERT INTO ORDERS
    VALUES(ORDERS_oNO_SEQ.NEXTVAL,'DEF','김김동','경기도 수원시','010-8888-8888',SYSDATE);
